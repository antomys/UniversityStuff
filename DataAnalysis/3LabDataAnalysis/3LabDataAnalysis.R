motorcars <- read.csv("https://raw.githubusercontent.com/vincentarelbundock/Rdatasets/master/csv/MASS/road.csv", stringsAsFactors = FALSE)
mtrcars <- (motorcars[,2:length(motorcars)])
#?????????????? ?????????????? ?? ????????????????
View(motorcars)
#A data frame with the annual deaths in road accidents for half the US states.
#state - name.

#deaths - number of deaths.

#drivers -number of drivers (in 10,000s).

#popden -population density in people per square mile.

#rural -length of rural roads, in 1000s of miles.

#temp -average daily maximum temperature in January.

#fuel - fuel consumption in 10,000,000 US gallons per year.

cor.test(motorcars$deaths, motorcars$drivers,method="pearson") #Correlation by Pearson +Ð·Ð½Ð°ÑÑÑÑÑÑÑ

cor.test(motorcars$deaths, motorcars$drivers,method="spearman") #Correlation by Spearman +Ð·Ð½Ð°ÑÑÑÑÑÑÑ

cor.test(motorcars$deaths, motorcars$drivers,method="kendal")#Correlation by Kendall +Ð·Ð½Ð°ÑÑÑÑÑÑÑ

plot(motorcars$deaths, motorcars$drivers, xlab = 'Deaths', ylab = 'Drivers') #?????????? ???????????????? ??????????????????????

motorcars.cor=cor(motorcars[,2:length(motorcars)]) #?????? ?????????????????? ??????????????

mc_data <- motorcars[,2:length(motorcars)] #???????? ?? ???????????????? ?????????? (??) ???? ??????????????
round(cor(mc_data),2) #?????????????????????? ??????????????

plot(motorcars$fuel, motorcars$rural) #???????????????? ?????????????????????? ???????? ?????????? ??????????????. ???????????? ??????


head(mtrcars) # ?????? ???????? ?????????????? ?????????? 6 ?????????????? ???? ??????????????

par(mfrow = c(2,2)) #???? ???????????? ???????????????? ?????????????????? ?????? 4 ??????????????
plot(motorcars$drivers, motorcars$deaths) #drivers +deaths
plot(motorcars$drivers, motorcars$popden) #Ð´ÑÐ°Ð¹Ð²ÐµÑ + Ð³ÑÑÑÐ¸Ð½Ð°
plot(motorcars$drivers, motorcars$rural) #Ð´ÑÐ°Ð¹Ð²ÐµÑ +ÑÑÑÐ°Ð»
plot(motorcars$drivers, motorcars$temp) #Ð´ÑÐ°Ð¹Ð²ÐµÑ+ÑÐµÐ¼Ð¿

pairs(mtrcars[,1:5], panel = panel.smooth)  #?????????? ???????????????? ???????????????? ?????????????????????? ???? ???????????????? ???????????????????? ??????my
library("Hmisc") #?????????????? ????????????????????

motorcars.rcorr= rcorr(as.matrix(mtrcars)) #?????????????????? ?????????????????????? ?????????????? ??????????. ????????
motorcars.rcorr


motorcars.coeff = motorcars.rcorr$r #?????????????????? ???????????????? p ?????? ?????????????????????? ?????????????????? ?? ????????????
motorcars.p = motorcars.rcorr$P # ?????????????????? ???????????????? p ?????? ?????????????????????? ?????????????????? ?? ????????????

motorcars.coeff #display
motorcars.p #display

res <- cor(mtrcars)
round(res, 2)#???? ???????? ?????????????? ??????????????????

install.packages("corrplot") 
library(corrplot) #install package

corrplot(res, type="upper") #???????????? ?????????????????? ???? ????????????????????

# mat : is a matrix of data
# ... : further arguments to pass to the native R cor.test function
cor.mtest <- function(mat, ...) {
  mat <- as.matrix(mat)
  n <- ncol(mat)
  p.mat<- matrix(NA, n, n)
  diag(p.mat) <- 0
  for (i in 1:(n - 1)) {
    for (j in (i + 1):n) {                           #??????????, ???????? ???????????????? ???????????????????? ???????????????? ???????????????? ??????????????????(??????????????)
      tmp <- cor.test(mat[, i], mat[, j], ...)
      p.mat[i, j] <- p.mat[j, i] <- tmp$p.value
    }
  }
  colnames(p.mat) <- rownames(p.mat) <- colnames(mat)
  p.mat
}
# matrix of the p-value of the correlation
p.mat <- cor.mtest(mtcars)
head(p.mat[, 1:5])



corrplot(res, type="upper",order="hclust",
         p.mat=p.mat,sig.level = 0.01)

corrplot(res, method = "number") #???????????? ?????????????????? ?? ????????????????????

palette = colorRampPalette(c("green", "white", "red")) (20)
heatmap(x = res, col = palette, symm = TRUE)    #ÐÑÐ°ÑÑÐº ÐºÐ¾ÑÐµÐ»ÑÑÑÑ ÑÐ¸Ð¿Ñ heatmap

install.packages("gclus")
library(gclus)

# ?????????????? ???????????? ?????????????????????????? (???? ????????????)
coeffs <- abs(cor(motorcars[2:7])) 
coeffs

# ?????????????? ?????????? (???????????????????????????? ?????????????????? ???? ?????????????? ??????????????????????????)
colors <- dmat.color(coeffs) 
colors
# ?????????????????????? ??????, ?????????? ??????????????, ?????? ?????????? ???????????????????? ????????????????????,
# ???????? ?????????? ?? ??????????????????

order <- order.single(coeffs)
order
# ???????????? ?????? ????????????

# gap - ???????????????????? ?????????? ?????????????????? ?? ??????????????

cpairs(motorcars[2:7], order, panel.colors = colors, gap = .5,
       main = "Correlations Car Specifications" )

library(lattice) #ÐÐ¾Ð´Ð°Ñ Ð±ÑÐ±Ð»ÑÐ¾ÑÐµÐºÑ

lattice::splom(motorcars[, 2:7])  #?????? ???????????? ??????????????????(???????? ????????????????????)

library(qgraph)
M <- cor(mtrcars) # ?????????????? ??????????????i?? ?????? ?????????? ?????? ??????????????i??i
qgraph(M) # ???????????????? ??????????i?? ??????????????
#
grp<-as.factor(c(1,1,3,1,2,1))# ???????????? ??????????i?? ????????
# ???????????????? ????????i?? ??????????????:
qgraph(M,layout="groups",groups=grp,minimum=0.5)

#4) ???????????????????? ???????????????????? ?????????????? ?????????????? (???)  
pogYou=table(motorcars$drivers,motorcars$deaths)            #chi-squared method
chisq.test(pogYou)

pogU=cbind(pogYou[,"enriched"],pogYou[,"100%"]+pogYou[,"none"])
chisq.test(pogU)

pogYou=table(motorcars$popden,motorcars$deaths)
chisq.test(pogYou)


pog=table(motorcars$drivers,motorcars$deaths)
chi2=chisq.test(pog)
c(chi2$statistic, chi2$p.value)
sqrt(chi2$statistic / sum(pog))     #Crammer's V method


res.aov <- aov(motorcars$popden ~ motorcars$deaths, data = motorcars)   #ANOVA
summary(res.aov)
